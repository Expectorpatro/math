\section{协方差}

\begin{definition}
	随机向量$\mathbf{X}$与随机向量$\mathbf{Y}$的\gls{Covariance}矩阵定义为：
	\begin{equation*}
		\operatorname{Cov}(\mathbf{X},\mathbf{Y})=\operatorname{E}\Bigl[\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\Bigl(\mathbf{Y}-\operatorname{E}(\mathbf{Y})\Bigr)^T\Bigr]
	\end{equation*}
	若$\mathbf{X}=\mathbf{Y}$，则可将$\operatorname{Cov}(\mathbf{X},\mathbf{Y})$简写为$\operatorname{Cov}(\mathbf{X})$。
\end{definition}
\begin{definition}
	设$X,Y$是两个随机变量，则：
	\begin{enumerate}
		\item 若$\operatorname{Cov}(X,Y)>0$，称$X,Y$\gls{PositivelyCorrelated}；
		\item 若$\operatorname{Cov}(X,Y)<0$，称$X,Y$\gls{NegativelyCorrelated}；
		\item 若$\operatorname{Cov}(X,Y)=0$，称$X,Y$\gls{Uncorrelated}。
	\end{enumerate}
\end{definition}
\begin{property}\label{prop:CovMat}
	协方差矩阵具有如下性质：
	\begin{enumerate}
		\item $X$是一个$n$维随机向量，则$\operatorname{tr}[\operatorname{Cov}(\mathbf{X})]=\sum\limits_{i=1}^{n}\operatorname{Var}(\mathbf{X}_i)$；
		\item $X$是一个$n$维随机向量，则$\operatorname{Cov}(\mathbf{X})$是半正定的对称矩阵；
		\item 设$A$和$B$分别为$p\times n$和$q\times m$非随机矩阵，$\mathbf{X}$和$\mathbf{Y}$分别为$n$维、$m$维随机向量，则：
		\begin{equation*}
			\operatorname{Cov}(A\mathbf{X},B\mathbf{Y})=A\operatorname{Cov}(\mathbf{X},\mathbf{Y})B^T
		\end{equation*}
		\item 若$\mathbf{X}$是一个常数向量，$\mathbf{Y}$是一个随机向量，则$\operatorname{Cov}(\mathbf{X},\mathbf{Y})=\mathbf{0}$；
		\item 设$\mathbf{X},\mathbf{Y},\mathbf{Z}$为随机向量，则：
		\begin{gather*}
			\operatorname{Cov}(\mathbf{X}+\mathbf{Y},\mathbf{Z})=\operatorname{Cov}(\mathbf{X},\mathbf{Z})+\operatorname{Cov}(\mathbf{Y},\mathbf{Z}) \\
			\operatorname{Cov}(\mathbf{X},\mathbf{Y}+\mathbf{Z})=\operatorname{Cov}(\mathbf{X},\mathbf{Y})+\operatorname{Cov}(\mathbf{X},\mathbf{Z})
		\end{gather*}
		\item $\operatorname{Cov}(\mathbf{X})=\operatorname{E}(\mathbf{X}\mathbf{X}^T)-[\operatorname{E}(\mathbf{X})][\operatorname{E}(\mathbf{X})]^T$。
	\end{enumerate}
\end{property}
\begin{proof}
	(1)$\;\operatorname{Cov}(\mathbf{X})$在$(i,i)$位置上的元素为：
	\begin{equation*}
		\operatorname{E}\Bigl[\Bigl(\mathbf{X}_i-\operatorname{E}(\mathbf{X}_i)\Bigr)\Bigl(\mathbf{X}_i-\operatorname{E}(\mathbf{X}_i)\Bigr)^T\Bigr]=\operatorname{E}\Bigl[\Bigl(\mathbf{X}_i-\operatorname{E}(\mathbf{X}_i)\Bigr)^2\Bigr]=\operatorname{Var}(\mathbf{X}_i)
	\end{equation*}
	所以$\operatorname{tr}[\operatorname{Cov}(\mathbf{X})]=\sum\limits_{i=1}^{n}\operatorname{Var}(\mathbf{X}_i)$。\par
	(2)因为：
	\begin{align*}
	\operatorname{Cov}(\mathbf{X})_{(i,j)}
	&=\operatorname{E}\Bigl[\Bigl(\mathbf{X}_i-\operatorname{E}(\mathbf{X}_i)\Bigr)\Bigl(\mathbf{X}_j-\operatorname{E}(\mathbf{X}_j)\Bigr)^T\Bigr] \\
	&=\operatorname{E}\Bigl[\Bigl(\mathbf{X}_j-\operatorname{E}(\mathbf{X}_j)\Bigr)\Bigl(\mathbf{X}_i-\operatorname{E}(\mathbf{X}_i)\Bigr)^T\Bigr] \\
	&=\operatorname{Cov}(\mathbf{X})_{(j,i)}
	\end{align*}
	所以$\operatorname{Cov}(\mathbf{X})$是一个对称矩阵。\par
	取$n$维非随机向量$c$，设$Y=c^T\mathbf{X}$则有：
	\begin{align*}
		\operatorname{Var}(Y)
		&=\operatorname{Var}(c^T\mathbf{X}) \\
		&=\operatorname{E}\Bigl[\Bigl(c^T\mathbf{X}-\operatorname{E}(c^T\mathbf{X})\Bigr)\Bigl(c^T\mathbf{X}-\operatorname{E}(c^T\mathbf{X})\Bigr)\Bigr] \\
		&=\operatorname{E}\Bigl[\Bigl(c^T\mathbf{X}-c^T\operatorname{E}(\mathbf{X})\Bigr)\Bigl(c^T\mathbf{X}-c^T\operatorname{E}(\mathbf{X})\Bigr)^T\Bigr] \\
		&=\operatorname{E}\Bigl\{c^T\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\Bigl[c^T\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\Bigr]^T\Bigr\} \\
		&=c^T\operatorname{E}\Bigl[\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)^T\Bigr]c \\
		&=c^T\operatorname{Cov}(\mathbf{X})c\geqslant0
	\end{align*}
	由$c$的任意性，$\operatorname{Cov}(\mathbf{X})$是半正定的。\par
	(3)类似于(2)中的推导，有：
	\begin{align*}
		\operatorname{Cov}(A\mathbf{X},B\mathbf{Y})
		&=\operatorname{E}\Bigl[\Bigl(A\mathbf{X}-\operatorname{E}(A\mathbf{X})\Bigr)\Bigl(B\mathbf{Y}-\operatorname{E}(B\mathbf{Y})\Bigr)^T\Bigr] \\
		&=A\operatorname{E}\Bigl[\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\Bigl(\mathbf{Y}-\operatorname{E}(\mathbf{Y})\Bigr)^T\Bigr]B^T \\
		&=A\operatorname{Cov}(\mathbf{X},\mathbf{Y})B^T
	\end{align*}\par
	(4)由协方差的定义直接可得；\par
	(5)由\info{期望的线性性}可得：
	\begin{gather*}
		\begin{aligned}
			\operatorname{Cov}(\mathbf{X}+\mathbf{Y},\mathbf{Z})
			&=\operatorname{E}\left[\Bigl(\mathbf{X}+\mathbf{Y}-\operatorname{E}(\mathbf{X}+\mathbf{Y})\Bigr)\Bigl(\mathbf{Z}-\operatorname{E}(\mathbf{Z})\Bigr)^T\right] \\
			&=\operatorname{E}\left[\Bigl(\mathbf{X}+\mathbf{Y}-\operatorname{E}(\mathbf{X})-\operatorname{E}(\mathbf{Y})\Bigr)\Bigl(\mathbf{Z}-\operatorname{E}(\mathbf{Z})\Bigr)^T\right] \\
			&=\operatorname{E}\left[\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\Bigl(\mathbf{Z}-\operatorname{E}(\mathbf{Z})\Bigr)^T+\Bigl(\mathbf{Y}-\operatorname{E}(\mathbf{Y})\Bigr)\Bigl(\mathbf{Z}-\operatorname{E}(\mathbf{Z})\Bigr)^T\right] \\
			&=\operatorname{E}\Bigl[\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\Bigl(\mathbf{Z}-\operatorname{E}(\mathbf{Z})\Bigr)^T\Bigr]+\operatorname{E}\Bigl[\Bigl(\mathbf{Y}-\operatorname{E}(\mathbf{Y})\Bigr)\Bigl(\mathbf{Z}-\operatorname{E}(\mathbf{Z})\Bigr)^T\Bigr] \\
			&=\operatorname{Cov}(\mathbf{X},\mathbf{Z})+\operatorname{Cov}(\mathbf{Y},\mathbf{Z})
		\end{aligned} \\
		\begin{aligned}
			\operatorname{Cov}(\mathbf{X},\mathbf{Y}+\mathbf{Z})
			&=\operatorname{E}\left[\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\Bigl(\mathbf{Y}+\mathbf{Z}-\operatorname{E}(\mathbf{Y}+\mathbf{Z})\Bigr)^T\right] \\
			&=\operatorname{E}\left[\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\Bigl(\mathbf{Y}+\mathbf{Z}-\operatorname{E}(\mathbf{Y})-\operatorname{E}(\mathbf{Z})\Bigr)^T\right] \\
			&=\operatorname{E}\left[\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\Bigl(\mathbf{Y}-\operatorname{E}(\mathbf{Y})\Bigr)^T+\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\Bigl(\mathbf{Z}-\operatorname{E}(\mathbf{Z})\Bigr)^T\right] \\
			&=\operatorname{E}\left[\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\Bigl(\mathbf{Y}-\operatorname{E}(\mathbf{Y})\Bigr)^T\right]+\operatorname{E}\left[\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\Bigl(\mathbf{Z}-\operatorname{E}(\mathbf{Z})\Bigr)^T\right] \\
			&=\operatorname{Cov}(\mathbf{X},\mathbf{Y})+\operatorname{Cov}(\mathbf{X},\mathbf{Z})
		\end{aligned}
	\end{gather*}\par
	(6)显然：
	\begin{align*}
		\operatorname{Cov}(\mathbf{X})
		&=\operatorname{E}\Bigl[\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)^T\Bigr]
		=\operatorname{E}\Bigl[\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\mathbf{X}^T-\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\operatorname{E}(\mathbf{X})^T\Bigr] \\
		&=\operatorname{E}\Bigl[\Bigl(\mathbf{X}-\operatorname{E}(\mathbf{X})\Bigr)\mathbf{X}^T\Bigr]-\operatorname{E}[\mathbf{X}-\operatorname{E}(\mathbf{X})]\operatorname{E}(\mathbf{X})^T =\operatorname{E}(\mathbf{X}\mathbf{X}^T)-[\operatorname{E}(\mathbf{X})][\operatorname{E}(\mathbf{X})]^T\qedhere
	\end{align*}
\end{proof}
